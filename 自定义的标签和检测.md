è¿™éƒ¨åˆ†å¾ˆéº»çƒ¦ã€‚

æœ¬äººä¸å»ºè®®ä»»ä½•æ–°æ‰‹åœ¨æœªå­¦ä¹ å®Œå…¨éƒ¨ç”¨æ³•ä¸”ç†Ÿç»ƒæŒæ¡çš„å‰æä¸‹å°è¯•è‡ªå®šä¹‰æ ‡ç­¾å’Œæ£€æµ‹ã€‚

è€Œä¸”å¸¸æœ‰ä¸€äº›ååˆ†è¯¡å¼‚çš„bugå‡ºç°ï¼Œç”šè‡³å¯¼è‡´æ¸¸æˆå´©æºƒã€‚

å»ºè®®æ–°æ‰‹å…ˆå­¦ä¹ å®Œæ‰€æœ‰ç”¨æ³•ï¼Œå†å°è¯•è‡ªå®šä¹‰æ ‡ç­¾å’Œæ£€æµ‹ã€‚

ä¸‹é¢å¼€å§‹æ­£å¼æ•™ç¨‹ã€‚

---
# Hacknet æ¨¡ç»„å¼€å‘æŒ‡å—ï¼šæ ‡ç­¾æ£€æµ‹ä¸ä¸€æ¬¡æ€§è§¦å‘ç³»ç»Ÿ

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—å°†æ•™ä½ åˆ›å»ºä¸€ä¸ª Hacknet æ¨¡ç»„ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š
- æ£€æµ‹è®¡ç®—æœºæ˜¯å¦åŒ…å«ç‰¹å®šæ ‡ç­¾
- è¿è¡Œè‡ªå®šä¹‰ EXE ç¨‹åºè¾“å‡ºç‰¹å®šä¿¡æ¯
- ç¡®ä¿æ¯æ¬¡è¿æ¥èŠ‚ç‚¹åªè§¦å‘ä¸€æ¬¡
- æ”¯æŒå­˜æ¡£æŒä¹…åŒ–

## ğŸ“ æ–‡ä»¶æ¶æ„

```
YourMod/
â”œâ”€â”€ YourModMain.cs      // æ’ä»¶ä¸»å…¥å£
â”œâ”€â”€ ModCore.cs          // æ ¸å¿ƒé€»è¾‘ç®¡ç†å™¨
â”œâ”€â”€ YourModStorage.cs   // æ•°æ®å­˜å‚¨ç³»ç»Ÿ
â”œâ”€â”€ TestTagNode.cs      // æ ‡ç­¾èŠ‚ç‚¹å®šä¹‰
â”œâ”€â”€ TestTagLoader.cs    // XMLæ ‡ç­¾åŠ è½½å™¨
â””â”€â”€ TestTagExe.cs       // è‡ªå®šä¹‰å¯æ‰§è¡Œç¨‹åº
```

## ğŸ”§ è¯¦ç»†å®ç°è¯´æ˜

### 1. æ’ä»¶ä¸»å…¥å£ (YourModMain.cs)
```csharp
// ä½œç”¨ï¼šæ¨¡ç»„å¯åŠ¨å…¥å£ï¼Œæ³¨å†Œæ‰€æœ‰ç»„ä»¶
[BepInPlugin(ModGUID, ModName, ModVer)]
public class YourModMain : HacknetPlugin
{
    public override bool Load()
    {
        new ModCore(); // åˆå§‹åŒ–æ ¸å¿ƒç®¡ç†å™¨
        // æ³¨å†Œè‡ªå®šä¹‰EXEç¨‹åº
        Pathfinder.Executable.ExecutableManager.RegisterExecutable<TestTagExe>("#TestTagExe#");
        return true;
    }
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `BepInPlugin` å±æ€§å£°æ˜æ¨¡ç»„ä¿¡æ¯
- åœ¨ `Load()` æ–¹æ³•ä¸­åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
- å¿…é¡»ä½¿ç”¨ `ExecutableManager.RegisterExecutable` æ³¨å†ŒEXEç¨‹åº

### 2. æ ¸å¿ƒé€»è¾‘ç®¡ç†å™¨ (ModCore.cs)
```csharp
// ä½œç”¨ï¼šç®¡ç†è§¦å‘çŠ¶æ€ã€å¤„ç†å­˜æ¡£äº‹ä»¶
public class ModCore
{
    private static HashSet<string> triggeredComputers = new HashSet<string>();
  
    public ModCore()
    {
        // æ³¨å†Œå­˜æ¡£åŠ è½½å’Œä¿å­˜äº‹ä»¶
        EventManager<SaveComputerLoadedEvent>.AddHandler(OnComputerLoaded);
        EventManager<SaveComputerEvent>.AddHandler(OnComputerSave);
    }
  
    public static bool CanTriggerOnComputer(string compId)
    {
        // æ£€æŸ¥æ˜¯å¦å·²è§¦å‘ï¼Œç¡®ä¿æ¯æ¬¡è¿æ¥åªè§¦å‘ä¸€æ¬¡
        if (triggeredComputers.Contains(compId))
            return false;
        triggeredComputers.Add(compId);
        return true;
    }
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `HashSet` è·Ÿè¸ªå·²è§¦å‘çš„è®¡ç®—æœº
- é€šè¿‡äº‹ä»¶ç³»ç»Ÿå¤„ç†å­˜æ¡£çš„åŠ è½½å’Œä¿å­˜
- `CanTriggerOnComputer` æ–¹æ³•æ˜¯è§¦å‘æ§åˆ¶çš„æ ¸å¿ƒ

### 3. æ•°æ®å­˜å‚¨ç³»ç»Ÿ (YourModStorage.cs)
```csharp
// ä½œç”¨ï¼šæä¾›å…¨å±€æ•°æ®è®¿é—®æ¥å£
public static class YourModStorage
{
    private static Dictionary<string, TestTagNode> nodes = new Dictionary<string, TestTagNode>();
  
    public static void AddOrUpdate(string compId, TestTagNode node)
    {
        nodes[compId] = node;
    }
  
    public static bool HasNode(string compId)
    {
        return nodes.ContainsKey(compId);
    }
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨é™æ€å­—å…¸å­˜å‚¨æ‰€æœ‰æ ‡ç­¾èŠ‚ç‚¹
- æä¾›çº¿ç¨‹å®‰å…¨çš„è®¿é—®æ–¹æ³•
- è®¡ç®—æœºIDä½œä¸ºå­—å…¸é”®å€¼

### 4. æ ‡ç­¾èŠ‚ç‚¹å®šä¹‰ (TestTagNode.cs)
```csharp
// ä½œç”¨ï¼šå®šä¹‰æ ‡ç­¾çš„æ•°æ®ç»“æ„
public class TestTagNode
{
    public bool HasTriggered { get; set; } = false;
  
    public static TestTagNode FromXml(ElementInfo info)
    {
        var node = new TestTagNode();
        // ä»XMLå±æ€§è¯»å–è§¦å‘çŠ¶æ€
        if (info.Attributes.TryGetValue("HasTriggered", out string triggeredStr))
        {
            node.HasTriggered = bool.Parse(triggeredStr);
        }
        return node;
    }
}
```

**å…³é”®ç‚¹ï¼š**
- `HasTriggered` å±æ€§ç”¨äºè·¨æ¸¸æˆä¼šè¯çš„æŒä¹…åŒ–
- `FromXml` æ–¹æ³•å¤„ç†å­˜æ¡£æ•°æ®çš„ååºåˆ—åŒ–

### 5. XMLæ ‡ç­¾åŠ è½½å™¨ (TestTagLoader.cs)
```csharp
// ä½œç”¨ï¼šè§£æè®¡ç®—æœºXMLä¸­çš„è‡ªå®šä¹‰æ ‡ç­¾
[ComputerExecutor("TestTag")]
public class TestTagLoader : ContentLoader.ComputerExecutor
{
    public override void Execute(EventExecutor exec, ElementInfo info)
    {
        string compId = Comp.idName ?? Comp.name;
        var node = new TestTagNode();
        YourModStorage.AddOrUpdate(compId, node);
    }
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `[ComputerExecutor("TestTag")]` å±æ€§å£°æ˜æ ‡ç­¾å¤„ç†å™¨
- åœ¨æ¸¸æˆåŠ è½½è®¡ç®—æœºæ—¶è‡ªåŠ¨è°ƒç”¨
- å°†æ ‡ç­¾ä¿¡æ¯å­˜å…¥å…¨å±€å­˜å‚¨

### 6. è‡ªå®šä¹‰å¯æ‰§è¡Œç¨‹åº (TestTagExe.cs)
```csharp
// ä½œç”¨ï¼šå®ç°å…·ä½“çš„æ£€æµ‹å’Œè¾“å‡ºé€»è¾‘
public class TestTagExe : BaseExecutable
{
    public TestTagExe(Rectangle location, OS operatingSystem, string[] args) 
        : base(location, operatingSystem, args)
    {
        // è·å–ç›®æ ‡è®¡ç®—æœº
        var targetComp = os.connectedComp ?? os.thisComputer;
        string compId = targetComp.idName ?? targetComp.name;
      
        // æ£€æŸ¥æ ‡ç­¾å­˜åœ¨æ€§
        if (!YourModStorage.HasNode(compId))
        {
            os.write("NO TestTag!");
            needsRemoval = true;
            return;
        }
      
        // æ£€æŸ¥è§¦å‘æƒé™
        if (!ModCore.CanTriggerOnComputer(compId))
        {
            os.write("Computer TESTED!");
            needsRemoval = true;
            return;
        }
      
        // æ‰§è¡Œä¸»è¦é€»è¾‘
        os.write("test complete");
        needsRemoval = true;
    }
}
```

**å…³é”®ç‚¹ï¼š**
- ç»§æ‰¿ `BaseExecutable` ç±»
- åœ¨æ„é€ å‡½æ•°ä¸­å®Œæˆæ‰€æœ‰é€»è¾‘ï¼ˆå› ä¸ºç¨‹åºç«‹å³ç»“æŸï¼‰
- ä½¿ç”¨ `needsRemoval = true` è®©ç¨‹åºæ‰§è¡Œåè‡ªåŠ¨ç§»é™¤
- ä¸‰å±‚æ£€æŸ¥æœºåˆ¶ç¡®ä¿æ­£ç¡®è§¦å‘

## ğŸ® ä½¿ç”¨æµç¨‹

### 1. åœ¨è®¡ç®—æœºXMLä¸­æ·»åŠ æ ‡ç­¾
```xml
<computer name="TestComputer" ip="123.45.67.89" security="2">
    <!-- å…¶ä»–è®¡ç®—æœºé…ç½® -->
    <TestTag />
</computer>
```

### 2. åœ¨æ¸¸æˆä¸­è¿è¡ŒEXE
```
run #TestTagExe#
```

### 3. é¢„æœŸè¾“å‡ºç»“æœ

| åœºæ™¯ | è¾“å‡ºå†…å®¹ | è¯´æ˜ |
|------|----------|------|
| é¦–æ¬¡è¿è¡Œï¼ˆæœ‰æ ‡ç­¾ï¼‰ | `test complete` | æ­£å¸¸è§¦å‘ |
| é‡å¤è¿è¡Œï¼ˆåŒä¸€è¿æ¥ï¼‰ | `Computer TESTED!` | é˜²æ­¢é‡å¤è§¦å‘ |
| æ— æ ‡ç­¾è®¡ç®—æœº | `NO TestTag!` | æ ‡ç­¾æ£€æµ‹å¤±è´¥ |
| é‡æ–°è¿æ¥åè¿è¡Œ | `test complete` | è¿æ¥é‡ç½®åé‡æ–°è§¦å‘ |

## ğŸ”„ è§¦å‘æœºåˆ¶è¯¦è§£

### ä¼šè¯çº§åˆ«æ§åˆ¶
- **EXEå®ä¾‹çº§åˆ«**ï¼š`hasTriggeredThisSession` ç¡®ä¿åŒä¸€ç¨‹åºå®ä¾‹ä¸é‡å¤è§¦å‘
- **è¿æ¥ä¼šè¯çº§åˆ«**ï¼š`ModCore.CanTriggerOnComputer()` ç¡®ä¿åŒä¸€è¿æ¥åªè§¦å‘ä¸€æ¬¡
- **æ¸¸æˆä¼šè¯çº§åˆ«**ï¼š`TestTagNode.HasTriggered` è®°å½•å†å²è§¦å‘çŠ¶æ€ï¼ˆç”¨äºå­˜æ¡£ï¼‰

### é‡ç½®æ¡ä»¶
å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œè§¦å‘çŠ¶æ€ä¼šè¢«é‡ç½®ï¼š
- ç©å®¶ä½¿ç”¨ `disconnect` å‘½ä»¤
- è¿æ¥åˆ°å…¶ä»–è®¡ç®—æœº
- æ¸¸æˆé‡æ–°åŠ è½½

### ä¿®æ”¹æ ‡ç­¾åç§°
å°†æ‰€æœ‰æ–‡ä»¶ä¸­çš„ `TestTag` æ›¿æ¢ä¸ºä½ æƒ³è¦çš„æ ‡ç­¾åï¼š
```csharp
// åœ¨ TestTagLoader.cs ä¸­
[ComputerExecutor("YourCustomTag")]
```

### ä¿®æ”¹è¾“å‡ºä¿¡æ¯
åœ¨ `TestTagExe.cs` ä¸­ä¿®æ”¹ `os.write()` çš„å†…å®¹ï¼š
```csharp
os.write("ä½ çš„è‡ªå®šä¹‰è¾“å‡ºä¿¡æ¯");
```



## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘½åç©ºé—´ä¸€è‡´æ€§**ï¼šç¡®ä¿æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„å‘½åç©ºé—´
2. **GUIDå”¯ä¸€æ€§**ï¼šä¿®æ”¹ `ModGUID` ç¡®ä¿ä¸ä¸å…¶ä»–æ¨¡ç»„å†²çª
3. **XMLæ ‡ç­¾å¤§å°å†™**ï¼šXMLæ ‡ç­¾åç§°åŒºåˆ†å¤§å°å†™
4. **å­˜æ¡£å…¼å®¹æ€§**ï¼šä¿®æ”¹æ ‡ç­¾ç»“æ„æ—¶è€ƒè™‘æ—§å­˜æ¡£çš„å…¼å®¹æ€§

